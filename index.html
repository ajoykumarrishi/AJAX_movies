<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Rishi's Entertainment Search</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <style>
    .movie-card {
      margin: 1rem;
      box-sizing: border-box;
    }
  </style>
</head>

<body>
  <main class="container mt-5">
    <h1>Rishi's Entertainment Search</h1>
    <form id="search-form">
      <div class="input-group mb-3">
        <input type="text" class="form-control" id="search" placeholder="Search for a film of some type">
        <button id='submit' class="btn btn-primary" type="submit">Search</button>
      </div>
    </form>
    <section id="movies" class="row"></section>
  </main>

  <script>
    const submit = document.querySelector('#submit');
    const search = document.querySelector('#search');
    const moviesSection = document.querySelector('#movies');

    submit.addEventListener('click', function (event) {
      event.preventDefault();
      const query = search.value;
      if (query) {
        fetchMovies(query);
      }
    });

    function fetchMovies(query) {
      var httpRequest = new XMLHttpRequest();

      httpRequest.onload = function () {
        if (httpRequest.readyState === XMLHttpRequest.DONE) {
          if (httpRequest.status === 200) {
            var movies = JSON.parse(httpRequest.responseText);
            displayMovies(movies.Search);
          } else {
            const errorMessage = document.createElement('p');
            const errorTest = document.createTextNode = 'There was a problem with the request.';
            errorMessage.appendChild(errorTest);
            moviesSection.appendChild(errorMessage);
          }
        }
      }

      httpRequest.onerror = function () {
        console.log(httpRequest.statusText);
      }

      httpRequest.open('GET', 'https://www.omdbapi.com/?s=' + query + '&plot=long&apikey=b7da8d63');
      httpRequest.send(null);
    }

    function displayMovies(movies) {
        moviesSection.innerHTML = ''; // Clear previous results
        for (let movie of movies) {
          const movieCardCol = document.createElement('div');
          movieCardCol.className = 'col-sm-6 col-md-4 col-lg-3 d-flex align-items-stretch';

          const movieCard = document.createElement('div');
          movieCard.className = 'card movie-card';

          const moviePoster = document.createElement('img');
          moviePoster.src = movie.Poster;
          moviePoster.className = 'card-img-top';

          const cardBody = document.createElement('div');
          cardBody.className = 'card-body';

          const movieTitle = document.createElement('h5');
          movieTitle.className = 'card-title';
          movieTitle.textContent = movie.Title;

          const movieReleaseYear = document.createElement('p');
          movieReleaseYear.className = 'card-text';
          movieReleaseYear.textContent = `Year: ${movie.Year}`;

          const movieType = document.createElement('p');
          movieType.className = 'card-text';
          movieType.textContent = `Type: ${movie.Type}`;

          const imdbLink = document.createElement('a');
          imdbLink.href = `https://www.imdb.com/title/${movie.imdbID}`;
          imdbLink.target = '_blank';
          imdbLink.className = 'btn btn-primary';
          imdbLink.textContent = 'View on IMDb';

          cardBody.appendChild(movieTitle);
          cardBody.appendChild(movieReleaseYear);
          cardBody.appendChild(movieType);
          cardBody.appendChild(imdbLink);
          movieCard.appendChild(moviePoster);
          movieCard.appendChild(cardBody);
          movieCardCol.appendChild(movieCard);

          moviesSection.appendChild(movieCardCol);
        }
      }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
</body>

</html>